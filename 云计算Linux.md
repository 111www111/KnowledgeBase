# Linux

## 前言:

这部分大致会分为几个阶段,可以搜索前往,懒得做超链接了

1. Linux基础篇
2. Shell编程
3. 系统管理
4. Linux服务管理
5. Linux MySQL管理
6. 集群
7. 虚拟化
8. K8S

## 一、Linux基础篇

### 1. 关于VMware虚拟机环境

#### 1.1 准备环境

官方网站 http://www.vmware.com,安装过程省略.

当然,如果你接受建议,那么笔者建议学习环境的配置如下图所示

- **CPU:** 建议主频为**1GHz**以上
- **内存:** 建议**1GB**以上
- **硬盘:** 建议分区空闲空间**8GB**以上

有钱建议直接阿里云

镜像站 -> https://mirrors.aliyun.com/centos

#### 1.2 虚拟机的网络配置

​		虚拟机的网络配置包含下图中的几种模式 :

![image-20230810210949215](images/image-20230810210949215.png)

​	当你在安装虚拟机的时候,在真实机中会出现两个虚拟网卡,那么尝试解读一下,常见的通信模式

![image-20230810211219518](images/image-20230810211219518.png)

- 桥接模式 -> 用于虚拟机与本机真实网卡链接进行通信,使用真实机器通信

- NAT模式 ->  使用虚拟网卡 VMnet8 通信

- 仅主机模式 -> 使用虚拟网卡 VMnet1 通信

  | 链接方式 | 链接网卡     | 是否能连接本机 | 是否能链接局域网 | 是否能链接公网 |
  | -------- | ------------ | -------------- | ---------------- | -------------- |
  | 桥接     | 本机真实网卡 | 可以           | 可以             | 可以           |
  | NAT      | VMnet8       | 可以           | 不能             | 可以           |
  | 仅主机   | VMnet1       | 可以           | 不能             | 不能           |
  
  注意,当你选择桥接模式的时候, 前往 编辑 -> 虚拟网络编辑器,编辑桥接模式使用的网卡
  
  ![image-20230810213543074](images/image-20230810213543074.png)

### 2. 系统的分区

#### 2.1 磁盘分区

​	用通俗异动的话来解释什么是磁盘分区,把一个大硬盘,分成一个一个小的逻辑硬盘就是分区,分区后的硬盘还是一整块硬盘.

![image-20230810221040364](images/image-20230810221040364.png)

分区的两种形式:

- **MBR 分区表 :**  最大支持 2.1 TB 硬盘,最多支持四个分区

  - 主分区: 最多只能有4个
  - 扩展分区:
    - 最多只能有1个
    - 主分区加扩展分区最多有4个
    - 不能写入数据,只能包含逻辑分区

  - 逻辑分区

  参考windows分区逻辑,如图

  ![image-20230815232638570](images/image-20230815232638570.png)

- **GPT 分区表 :** 全局唯一标示分区表,支持9.4 ZB硬盘,理论上支持的分区没有限制,但是在windows 限制128个主分区

#### 2.2 格式化

​		格式化(高级格式化),又称为逻辑格式化,根据用户选定的文件系统(例如FAT 16,FAT 32,NTFS,EXT 2,EXT 3,EXT4等等),在磁盘的特定区域写入特定数据,再分区中划出一片用于存放文件分配表,目录表等用于文件管理的磁盘空间

​		一般情况下 Linux 的文件系统是EXT4

#### 2.3 设备文件名

![image-20230816222501513](images/image-20230816222501513.png)

建议记住的分区设备文件名,a表示硬盘顺序 如上图,后面的数据为分区编号

- /dev/hda1 (IDE硬盘接口,这个年代一般情况下都是光驱用这个接口了)
- /dev/sda1 (SCSI硬盘接口,SATA硬盘接口,现在一般都是SATA,还有USB等)

#### 2.4 挂载点

- 必须分区:
  - / : 根分区
  - swap分区(交换分区) :
    - 建议如果真实内存小于4 GB,swap为内存的两倍
    - 建议如果真实内存大于4 GB,swap和内存一致
    - 建议实验环境不大于2 GB
- 推荐分区:
  - /boot (启动分区,1GB)
- 常用分区:
  - /home (用于文件服务器)
  - /www (用于WEB服务器)

​		Linux使用已存在的空目录作为挂载点,理论上所有的空目录都可以当挂载点,但是/bin、/lib、/etc 这些除外,他们必须与根目录在一个目录下

​		借用华罗庚老师的一句话,数形结合百般好,看图知关系

![image-20230816225941049](images/image-20230816225941049.png)

​		参考,学习过程中的分区挂载点配置,如下图所示

![image-20230817201806226](images/image-20230817201806226.png)

#### 2.5 密码原则

- 复杂性: 

  - 建议大于八位

  - 建议大小写,数字,符号最少包含其中三种

  - 建议不使用和个人信息相关的内容

  - 建议不使用现有的英文单词

- 易记忆性:

  - 建议你的超复杂密码记得住,比如 flzx_3QC、DF_3mzPite

### 3. 远程登录

#### 3.1 配置IP地址

​	考虑到你在这里没有vi or vim的编辑经验,那么假如你的Centos版本是6.3+,你就可以直接通过下面的指令设置IP地址,注意 setup 只有Centos有

```
[root@localhost ~]# setup
#通过setup工具设置IP地址,注意激活onboot=yes
[root@localhost ~]# service network restart
#重启网络服务
```

如果你会用虚拟机,那么就是直接梭哈

```
vi /etc/sysconfig/network-scripts/ifcfg-ens33
```

这里需要注意,1.2中选择的网卡根据网卡设置相对应的网络配置

```
TYPE="Ethernet"
PROXY_METHOD="none"
BROWSER_ONLY="no"
BOOTPROTO="static"
DEFROUTE="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_FAILURE_FATAL="no"
IPV6_ADDR_GEN_MODE="stable-privacy"
NAME="ens33"
UUID="833c0800-3d58-4b9c-b7ab-709d607d48d3"
DEVICE="ens33"
ONBOOT="yes"
//这里的配置根据1.2中的网卡设置即可
IPADDR=192.168.10.101
GATEWAY=192.168.10.2
DNS1=192.168.10.2
```

#### 3.2 安装日志

```
/root/install.log : 储存了安装在系统中的软件包及其版本信息
/root/install.log.syslog : 存储了安装过程中留下的时间记录
/root/anaconda-ks.cfg : 以Kickstart配置文件的格式记录安装过程中设置的选项信息,这玩意后续可以当模板用,做集群
```

### 4. 一些Linux的注意事项

1. Linux是严格区分大小写的
2. Linux 一切皆文件,都是一文件的形式保存的,硬件设备也是文件,Linux的设备文件保存在/dev/目录中,硬盘文件的/dev/sd[a-p]
3. Linux不靠扩展名区分文件类型,而是靠权限位标识来确定文件类型的,常见的文件类型只有 普通文件、 目录、链接文件、块设备文件、字符设备文件等集中,Linux的可执行文件不过就是普通文件被赋予了可执行权限,但是有些特殊文件要求写扩展名称用来分辨
   - 压缩包:Linux下常见的压缩文件有 .gz 、.zip 、.tar.gz等,方便判断
   - 二进制软件包: Centos中使用的而二进制安装包是RPM包,所有的RPM包都用 .RPM结尾,方便判断
   - 程序脚本: shell脚本一般以 .sh 结尾,还有其他例如 .c 结尾的C语言文件等
   - 网页文件: 一般以 .html 或者 .php结尾,按照网页服务器的要求设置
4. Linux中所有的存储设备都必须在挂载之后使用 

### 5.Linux的目录结构

#### 5.1 一级目录

| 目录名称    | 目录作用                                                     |
| :---------- | :----------------------------------------------------------- |
| /bin/       | 存放系统命令的目录,普通用户和超级用户都可以执行,是/usr/bin目录的软连接 |
| /sbin/      | 存放系统命令的目录,只有超级用户才可以执行,是/usr/sbin目录的软连接 |
| /usr/sbin   | 存放系统命令的目录,只有超级用户才可以执行                    |
| /usr/bin    | 存放系统命令的目录,普通用户和超级用户都可以执行              |
| /boot       | 系统启动目录,保存与系统启动相关的文件,比如内核文件和启动引导程序(grub) |
| /dev        | 保存设备文件目录                                             |
| /etc        | 配置文件保存位置,系统内所有采用默认安装(rpm安装)方式的服务配置文件全部保存在此目录中,如用户信息,服务的启动脚本,常用的服务配置文件等 |
| /home       | 普通用户的家目录,在创建用户时,每个用户要有一个默认登陆和保存自己数据的位置,就是用户目录,所有普通用户的宿主目录实在/home下建立一个和用户名相同的目录,例如 用户 W1T 的home即为 /home/W1T/ |
| /lib        | 系统调用的函数库保存位置,是 /usr/lib的软连接                 |
| /lost+found | 当系统意外崩溃或者及其意外关机,会产生一些文件碎片在这里,当系统启动过程中fsck工具会检查到这里,并修复损坏的文件系统,这个目录只在每个分区中出现 |
| /media      | 挂载目录,系统建议用来挂载媒体设备,比如软盘,光盘              |
| /misc       | 挂载目录。系统建议用来挂载 NFS 服务的共享目录。系统虽然准备了三个默认挂载目录/media、/mnt、/misc，但是到底在哪个目录中挂载什么设备都可以由管理员自己决定。尽量养成在/mnt 下建立不同目录挂载不同设备的习惯。如/mnt/cdrom 挂载光盘，/mnt/usb 挂载 U盘的习惯 |
| /mnt        | 挂载目录,早期Linux只有这一个目录,没有细分,现在系统建议这个目录来挂载额外的设备,比如U盘,移动硬盘和其他操作系统分区 |
| /opt        | 第三方软件的安装位置,不过我还是比较适应/usr/local            |
| /proc       | 虚拟文件系统,该目录的数据并不保存在硬盘上,而是保存在内存中,主要保存系统内核,进程,外部设备状态和网络状态等 |
| /sys        | 虚拟文件系统,主要保存内核相关信息                            |
| /root       | root的宿主目录                                               |
| /run        | 系统运行时产生的数据,比如ssid,pid等相关数据,/var/run是此目录的软连接 |
| /selinux    | 用来设定 限制root权限的组件                                  |
| /srv        | 服务数据目录                                                 |
| /tmp        | 临时目录                                                     |
| /usr        | UNIX Software Resource,存放系统软件资源的目录,系统级的应用大多数保存在这里 |

#### 5.2 二级目录

| 二级目录         | 目录作用                                                     |
| ---------------- | ------------------------------------------------------------ |
| /usr/lib         | 应用程序调用的函数库保存位置                                 |
| /usr/local       | 手工安装的软件保存位置,我们一般建议把源码包软件安装在这个位置 |
| /usr/share       | 应用程序的资源文件保存位置,比如帮助文档,说明文档,字体等资源  |
| /usr/src         | 存放源程序,比如下载的源码包,内核源码,一般手工下载的源码包保存在/usr/local/src 中,把内核源码保存到/usr/src/kernels目录下 |
| /usr/src/kernels | 内核源码保存位置                                             |
| /var             | 动态数据保存位置,比如缓存,日志,软件运行产生的文件            |
| /var/www/html    | RPM包安装的Apache的网页目录                                  |
| /var/lib         | /程序运行中需要调用或改变的数据保存位置,比如mysql数据库保存在/var/lib/mysql目录中 |
| /var/log         | 系统日志保存位置                                             |
| /var/run         | 一些服务和成勋运行后,PID保存位置,是/run目录的软连接          |
| /var/spool       | 队列数据目录,就是排队等待其他程序使用的数据                  |
| /var/spool/mail  | 新收到邮件队列保存位置                                       |
| /var/spool/cron  | 定时任务队列保存位置                                         |

#### 5.3 关于服务器

##### 5.3.1 远程服务器注意事项

1. 远程服务器,不能关机,只能重启.你就想想看,是不是得按开机键
2. 远程服务器在重启前,要中止正在执行的服务,强制断电时硬盘没有进行数据交互
3. 重启命令建议使用 "shutdown -r now" ,这条命令再重启时会正常保存和中止服务器中正常运行的程序,是安全重启命令,而且最好在重启之前执行几次 "sync"数据同步命令,可以让暂时保存在内存的数据持久化在磁盘上
4. 不要再服务器访问高峰运行高负载命令,参考备份
5. 指定合理的密码规范并且定期更新
6. 合理的分配权限
7. 定期备份重要数据和日志
8. 配置防火墙的时候不要把自己踢出服务器.重要的事情说一遍

这里提一句,防火墙

防火墙的基本功能是数据包过滤,当前主流的过滤方案是

- IP地址
- MAC地址
- 端口号
- 协议类型
- 数据包中的数据

由于Linux 的防火墙是纯手工命令,所以配置规则和命令比较复杂,这里就要注意上述的问题,建议在服务器本地配置防火墙,这样就算不小心把自己的远程登陆过滤了,还可以通过本机登录来恢复,如果服务器已经在远程登陆配置防火墙,那么最好在本地测试后再上传,或者你写个定时任务,五分钟清一次防火墙规则,就算是出问题也有反悔的机会

