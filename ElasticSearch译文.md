# ElasticSearch译文 版本8.8

# 1.什么是ElasticSearch

你知道的，为了搜索（还有是分析）

Elasticsearch是一个分布式搜索引擎和分析引擎

Logstash和Beats便于收集、聚合和丰富数据，并将其存储在Elasticsearch中，

Kibana使您能够交互式地探索、可视化和共享对数据的见解，并管理和监视堆栈。

请将ELK组合使用，体验索引、搜索和分析的神奇之处。

Elasticsearch为所有类型的数据提供近乎实时的搜索和分析。无论您拥有结构化或非结构化文本、数字数据或地理空间数据，Elasticsearch都可以以支持快速搜索的方式高效地存储和索引数据。您可以超越简单的数据检索和聚合信息来发现数据中的趋势和模式。随着数据和查询量的增长，Elasticsearch的分布式特性使您的部署能够与之无缝增长。

虽然所有问题都并非是搜索的问题，但是Elasticsearch仍然提供了在各种情况下处理数据的速度和灵活性，例如

- 向应用程序或网站提供搜索框

- 存储和分析日志，指标以及安全数据

- 使用机器学习实时自动模拟数据的行为

- 使用Elasticsearch作为存储引擎自动化业务工作流

- 使用Elasticsearch分析，管理，继承地理信息系统

- 使用Elasticsearch作为生物信息学研究工具存储和处理遗传数据

我们对人们使用搜索的新奇方式不断感到惊讶。但是，无论您的用例与其中一个相似，还是您正在使用Elasticsearch解决一个新问题，您在Elasticsearch中处理数据、文档和索引的方式都是相同的。

## 数据来源：文件和索引

Elasticsearch是一个分布式的存储文档，他并不是将信息存储为列数据（参考MySQL），而是将数据存储为序列化后的JSON文档的复杂数据结构。当集群有多个Elasticsearch节点时。存储的文档分布在整个集群中，可以从任何节点访问

当一个文档被存储时，它几乎可以在一秒内实时的完成搜索。Elasticsearch使用了一种反向索引的数据结构，支持非常快速的全文搜索，而反向索引列出了任何文档中出现的每个唯一单词，并标识了每个单词所在的所有文档。

索引是一个可以被优化的集合文件，和每个文档一样，都是字段的集合。他们是由键值对构成的数据，默认情况下，Elasticsearch会为每个领域的数据编排索引，并且每个领域的索引字段都是专用的集合随手记

 Elasticsearch 还具有无模式的能力，这意味着无需明确指定如何处理文档中可能出现的每个不同字段即可对文档进行索引。启用动态映射后，Elasticsearch 会自动检测新字段并将其添加到索引中。这种默认行为使索引和探索数据变得很容易 - 只需开始索引文档，Elasticsearch 就会检测并将布尔值、浮点和整数值、日期和字符串映射到适当的 Elasticsearch 数据类型。 

但最终，您比 Elasticsearch 更了解您的数据以及您想要如何使用它。您可以定义规则来控制动态映射并显式定义映射以完全控制字段的存储和索引方式。

定义您自己的映射使您能够：

- 区分全文字符串字段和精确值字符串字段
- 执行特定于语言的文本分析
- 优化部分匹配的字段
- 使用自定义日期格式
- 使用无法自动检测到的 数据类型，例如`geo_point`和`geo_shape`

为了不同的目的以不同的方式对同一字段建立索引通常很有用。例如，您可能希望将字符串字段索引为全文搜索的文本字段和排序或聚合数据的关键字字段。或者，您可以选择使用多个语言分析器来处理包含用户输入的字符串字段的内容。

在索引期间应用于全文字段的分析链也在搜索时使用。当您查询全文字段时，在索引中查找术语之前，查询文本会经历相同的分析。



## 信息输出:搜索与分析

虽然您可以使用 Elasticsearch 作为文档存储并检索文档及其元数据，但真正的强大之处在于能够轻松访问基于 Apache Lucene 搜索引擎库构建的全套搜索功能 

Elasticsearch提供简单一致的REST风格API, 用于管理集群以及索引和搜索数据。出于测试目的，您可以直接从命令行或通过 Kibana 中的开发者控制台轻松提交请求。在您的应用程序中，您可以使用 适合您选择的语言的 的API操作 [Elasticsearch 客户端：Java、JavaScript、Go、.NET、PHP、Perl、Python 或 Ruby。](https://www.elastic.co/guide/en/elasticsearch/client/index.html) 

##  查询您的数据

Elastisearch 支持 REST 风格API的结构化查询, 全文查询以及两者结合的复杂查询,结构化查询与您使用的SQL查询类似,例如,您可以在员工索引(index)中,搜索性别和年龄字段,并且按照雇佣日期排序,全文查找与您输入的字符串相匹配的文档,并且您的排序规则返回他们与搜索词的相关匹配程度

除了单个查询以外,还可以执行短语搜索,相似度搜索,前缀搜索,并自动比对相似度

那么你是否有搜索的地理空间或其他数字数据的需求？Elasticsearch在支持高性能地理和数字查询的优化数据结构中对非文本数据进行索引。

总的来说你可以使用ElasticSearch的JSON 查询语句访问所有的搜索功能,当然您也可以构建sql风格的查询,以便本地搜索和聚合数据,也可以通过JDBC和ODBC驱动程序使广泛的第三方应用程序能够通过SQL与Elasticsearch进行交互。

## 分析您的数据

Elasticsearch聚合使您能够构建复杂的数据摘要，并深入了解关键指标、模式和趋势。聚合使您能够回答以下问题，而不仅仅是众所周知的“大海捞针”：

- 请问干草堆里藏有多少根针?
- 针的平均长度是多少?
- 按照制造商分组,针头长度中位数长度是多少?
- 再过去的六个月时间增加了多少根针?

您还可以使用聚合来回答更微妙的问题，例如：

- 最受欢迎的针头生产厂家是谁?
- 是否有坏的异常的针头出现?异常率是多少?

因为聚合使用了类似于查询的数据结构使得聚合的查询速度也非常可观,这使得你对数据的分析,可视化可以达到接近实时的地步,你的报告和可视化是根据数据变动的,所以这个功能可以使您的信息更加准确

更重要的是,聚合操作与搜索一起进行,你可以对文档进行查询,过滤结果,并且在单个请求下,短时间内,相同条件限制下的数据,完成分析聚合,由于聚合操作是在查询的上下文进行的,所以你不能仅仅显示某一条参数.

等等 还有更多

ElasticSearch具有分析时间序列数据的特效,所以基于这个特性,es可以作为机器学习的数据分析引擎



## 关于可扩展性,集群,节点和分片

ElasticSearch 可以根据您的想法通过分布式,构建高可用及其集群,你可以添加服务器(节点),ElasticSearch会自动为节点分配数据和查询负载,不需要更改底层的App即可完成,ElasticSearch知道如何平衡多节点以便达到分布式下的高可用,节点越多,效果越好

那么 这是如何做到的呢? 在后台,ES的索引实际上只是一个或多个物理分片的逻辑分组,其中每个碎片实际上是一个独立的索引, 通过将索引中的文档分布到多个分片,再通过分发这些分片到多个节点,当然,ES可以确保冗余,所以当新的节点添加至集群的时候,可以防止硬件故障,又可以提高查询能力,伴随着集群的膨胀或者缩小,ES会自动迁移切片以达到重新平衡集群的目的

在ES中 分片有两种类型,  主分片(primaries)  和  副本(replicas), 索引(index)中的每个文档(document)都属于一个主分片。 而副本分片将复制主分片,副本分片提供数据的冗余,防止硬件故障,并提供高可用的读取能力.

 索引中主分片的数量在创建索引时是固定的,而副本分片随时可以创建,不会中断主分片的运行或者查询操作.

当然,这些取决于..

 对于分片大小和为索引配置的主分片数量，存在许多性能考虑因素和权衡, 分片越多，维护这些索引的开销就越大。副本数越多,Es的自我平衡时间就会越长

TODO https://www.elastic.co/guide/en/elasticsearch/reference/8.8/scalability.html#it-depends

